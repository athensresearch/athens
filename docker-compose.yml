version: "3"
services:
  athens-server:
    build: .
    image: athens-server:1.0.0-alpha.rtc.2
    restart: always
    expose:
      - 3010 # Change this according to config.edn
    volumes:
      - datahike-db:/srv/athens/db
    environment:   # set environment variables
      # config_edn is deep merged with the whole config file
      config_edn: "{:datahike {:store {:path \"/srv/athens/db\"}}}"


  nginx:
    image: nginx
    depends_on:
      - athens-server
    restart: always
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    ports:
      - 80:80

volumes:
  datahike-db:
